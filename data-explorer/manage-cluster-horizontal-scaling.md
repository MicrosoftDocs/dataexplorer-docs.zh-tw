---
title: " (scale out) 管理叢集水準調整，以符合 Azure 資料總管中的需求"
description: 本文說明根據不斷變化的需求，在 Azure 資料總管叢集中相應放大和縮小的步驟。
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: how-to
ms.date: 12/09/2019
ms.openlocfilehash: 05d3e5be7f2c3c228c3db623c7798957fa101450
ms.sourcegitcommit: f354accde64317b731f21e558c52427ba1dd4830
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/26/2020
ms.locfileid: "88875135"
---
# <a name="manage-cluster-horizontal-scaling-scale-out-in-azure-data-explorer-to-accommodate-changing-demand"></a>在 Azure 資料總管中管理叢集水準規模調整 (scale out) ，以滿足不斷變化的需求

適當調整叢集的大小對 Azure 資料總管的效能來說非常重要。 靜態叢集大小可能導致使用量過低或使用量過高，兩者皆不理想。 因為無法以絕對精確度預測叢集的需求，所以最好是 *調整* 叢集、新增和移除具有變更需求的容量和 CPU 資源。 

有兩個用於調整 Azure 資料總管叢集的工作流程： 
* 水準調整，也稱為相應縮小和放大。
* [垂直調整](manage-cluster-vertical-scaling.md)，也稱為向上和向下調整。
本文說明水準調整工作流程。

## <a name="configure-horizontal-scaling"></a>設定水準調整

藉由使用水準調整，您可以根據預先定義的規則和排程，自動調整實例計數。 若要指定叢集的自動調整設定：

1. 在 Azure 入口網站中，移至您的 Azure 資料總管叢集資源。 在 [ **設定**] 底下，選取 [ **相應**放大]。 

2. 在 [ **Scale out** ] 視窗中，選取您要的自動調整方法： **手動調整規模**、 **優化自動**調整規模或 **自訂自動**調整。

### <a name="manual-scale"></a>手動調整

手動調整是叢集建立期間的預設設定。 叢集的靜態容量不會自動變更。 您可以使用 [ **實例計數** ] 列來選取靜態容量。 叢集的調整會維持在該設定，直到您進行其他變更為止。

   ![手動調整方法](media/manage-cluster-horizontal-scaling/manual-scale-method.png)

### <a name="optimized-autoscale"></a>優化自動調整

優化自動調整是建議的自動調整方法。 此方法可將叢集效能和成本優化。 如果叢集接近使用率的狀態，則會相應縮小。 此動作可降低成本，但會保留效能層級。 如果叢集接近使用率的狀態，則會相應放大以維持最佳效能。 若要設定優化自動調整：

1. 選取 [ **優化自動**調整]。 

1. 選取 [最小實例計數] 和 [最大實例計數]。 叢集會根據負載自動調整這兩個數字之間的範圍。

1. 選取 \[儲存\]。

   ![優化自動調整方法](media/manage-cluster-horizontal-scaling/optimized-autoscale-method.png)

優化自動調整開始運作。 在叢集的 Azure 活動記錄中，現在會顯示其動作。

#### <a name="logic-of-optimized-autoscale"></a>優化自動調整的邏輯 

**Scale out**

當您的叢集接近使用率的狀態時，請向外擴充以維持最佳效能。 當下列情況時，將會發生 Scale out：
* 叢集實例的數目低於使用者所定義的實例數目上限。
* 快取使用率很高，超過一小時。
* CPU 很高，超過一小時。
* 內嵌使用率很高，超過一小時。


**相應縮小**

當您的叢集接近使用率的狀態時，請縮減以降低成本，但維持效能。 使用多個計量來確認可在叢集中安全調整。 在執行 scale in 之前的6小時，會每小時評估下列規則：
* 實例數目超過2，並高於定義的實例數目下限。
* 為了確保不會有多載的資源，必須先驗證下列計量，才能執行 scale in： 
    * 快取使用率不高
    * CPU 低於平均 
    * 內嵌使用率低於平均 
    * 串流內嵌使用率 (是否使用串流內嵌) 不高
    * 保持運作事件超過定義的最小值、處理正常時間，以及時間。
    * 沒有查詢節流 
    * 失敗查詢的數目低於定義的最小值。

> [!NOTE]
> 調整規模的邏輯目前需要1天的評估，才能在中執行優化的縮減。 此評估會每6小時進行一次。 如果需要立即變更，請使用 [手動調整](#manual-scale)。

### <a name="custom-autoscale"></a>自訂自動調整

藉由使用自訂自動調整，您可以根據您指定的計量動態調整叢集規模。 下圖顯示設定自訂自動調整的流程和步驟。 更多詳細資料請參考圖形。

1. 在 [ **自動調整設定名稱** ] 方塊中輸入名稱，例如相應放大 *：快取使用率*。 

   ![調整規則](media/manage-cluster-horizontal-scaling/custom-autoscale-method.png)

2. 針對 **調整模式**，選取 [ **根據度量調整規模**]。 此模式提供動態調整。 您也可以選取 [ **調整為特定實例計數**]。

3. 選取 [ **+ 新增規則**]。

4. 在右側的 [ **調整規模規則** ] 區段中，輸入每個設定的值。

    **準則**

    | 設定 | 描述和值 |
    | --- | --- |
    | **時間彙總** | 選取彙總準則，例如 [平均]****。 |
    | **度量名稱** | 選取調整大小作業依據的計量，例如 [快取使用率]****。 |
    | **時間粒紋統計資料** | 選擇 [平均]****、[最小值]****、[最大值]****，或 [加總]****。 |
    | **運算子** | 選擇適當的選項，例如 [大於或等於]****。 |
    | **閾值** | 選擇適當的值。 例如，針對快取使用率，80% 是不錯的起點。 |
    | **持續時間 (分鐘) ** | 選擇適當的時間長度，讓系統在計算計量時有所依據。 從預設的 10 分鐘開始。 |
    |  |  |

    **動作**

    | 設定 | 描述和值 |
    | --- | --- |
    | **運算** | 選擇相應縮小或相應放大的適當選項。 |
    | **執行個體計數** | 選擇滿足計量條件時，您欲新增或移除的節點或執行個體數。 |
    | **冷卻時間 (分鐘)** | 選擇調整大小作業間適當的時間間隔。 請從預設的五分鐘開始。 |
    |  |  |

5. 選取 [新增]。

6. 在左側的 [ **實例限制** ] 區段中，輸入每個設定的值。

    | 設定 | 描述和值 |
    | --- | --- |
    | **最低** | 執行個體數；無論使用率為何，您的叢集都不會調整到低於此數值。 |
    | **最大值** | 執行個體數；無論使用率為何，您的叢集都不會調整到高於此數值。 |
    | **預設值** | 實例的預設數目。 如果在讀取資源計量時發生問題，則會使用此設定。 |
    |  |  |

7. 選取 \[儲存\]。

您現在已設定 Azure 資料總管叢集的水準調整規模。 新增另一個垂直調整的規則。 如果您需要叢集調整問題的協助，請在 Azure 入口網站中 [開啟支援要求](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview) 。

## <a name="next-steps"></a>後續步驟

* [使用計量來監視 Azure 資料總管效能、健康情況和使用量](using-metrics.md)
* [管理叢集垂直](manage-cluster-vertical-scaling.md) 調整以調整叢集的適當大小。
