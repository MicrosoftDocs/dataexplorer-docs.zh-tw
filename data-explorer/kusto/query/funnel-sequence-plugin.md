---
title: funnel_sequence外掛程式 - Azure 資料資源管理員 |微軟文件
description: 本文介紹 Azure 數據資源管理器中的funnel_sequence外掛程式。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/13/2020
ms.openlocfilehash: a0543d0083fd90d5ee3e6e94cf1ee203f6cbd50d
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/15/2020
ms.locfileid: "81514734"
---
# <a name="funnel_sequence-plugin"></a>funnel_sequence plugin

計算具有一系列狀態的使用者的不同計數,以及導致 / 的先前/下一個狀態的分佈,然後是序列。 

```kusto
T | evaluate funnel_sequence(id, datetime_column, startofday(ago(30d)), startofday(now()), 10m, 1d, state_column, dynamic(['S1', 'S2', 'S3']))
```

**語法**

*T* `| evaluate` T `,` *Start* `,` *End* `,` `funnel_sequence(` IdColumn 時間線列 開始結束最大序列步視窗 , 步驟 , 狀態列 , 序列*IdColumn*`,`*TimelineColumn**Step**Sequence**StateColumn**MaxSequenceStepWindow*`)`

**引數**

* *T*: 輸入表格表示式。
* *IdColum*:列引用,必須存在於源運算式中
* *時間軸列*:表示時間線的列引用,必須存在於源運算式中
* *開始*:分析開始期間的標量常數值
* *結束*:分析結束週期的標量常數值
* *最大序列步視窗*:序列中 2 個順序步驟之間允許的最大時間跨度的標量常數值
* *步驟*:分析步長週期的標量常數值(bin)
* *狀態列*:表示狀態的列引用,必須存在於源運算式中
* *序列*:具有序列值的常量動態陣列(值在`StateColumn`) 中抬起來。

**傳回**

傳回 3 個輸出表,可用於為分析序列建構 sankey 關係圖:

* 表#1 - 前序列-下一個 dcount TimelineColumn:分析的時間視窗前v:前 v 狀態(如果有任何使用者只有搜索序列的事件,但之前沒有任何事件,則可能是空的)。 
    下一個:下一個狀態(如果有任何使用者只有搜索序列的事件,但沒有任何後續事件,則可能為空)。 
    計數:轉換 [<IdColumn>前 一個] 的時間視窗的不同計<Sequence>數 - > -- > [下一個]。 
    範例:對應於列序列的<IdColumn>ID 陣列(最多返回 128 個 ID)。 

* 表#2 - 前v序列 dcount TimelineColumn:分析的時間視窗前段前:前 v 狀態(如果有任何使用者僅具有搜尋序列的事件,但之前沒有任何事件,則可能為空)。 
    計數:轉換 [<IdColumn>前 一個] 的時間視窗的不同計<Sequence>數 - > -- > [下一個]。 
    範例:對應於列序列的<IdColumn>ID 陣列(最多返回 128 個 ID)。 

* 表#3 - 序列下一個 dcount TimelineColumn:下一個分析的時間視窗:下一個狀態(如果有任何使用者只有搜尋序列的事件,但沒有任何後續事件,則可能為空)。 
    計數:轉換 [<IdColumn>前 一個] 的時間視窗的不同計<Sequence>數 - > -- > [下一個]。 
    範例:對應於列序列的<IdColumn>ID 陣列(最多返回 128 個 ID)。 


**範例**

### <a name="exploring-storm-events"></a>探索風暴事件 

下面的查詢將查看表 StormEvents(2007 年的天氣統計資訊),並顯示 2007 年發生的所有龍捲風事件之前或之後發生的事件。

```kusto
// Looking on StormEvents statistics: 
// Q1: What happens before Tornado event?
// Q2: What happens after Tornado event?
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, dynamic(['Tornado']))
```

結果包含 3 個表:

* 表#1:序列前後發生的所有可能變體。 例如,第二行告訴有 87 個不同的事件具有下一個序列:`Hail` -> `Tornado` -> `Hail`


|StartTime|prev|下一步|dcount|
|---|---|---|---|
|2007-01-01 00:00:00.0000000|||293|
|2007-01-01 00:00:00.0000000|Hail|Hail|87|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind|Thunderstorm Wind|77|
|2007-01-01 00:00:00.0000000|Hail|Thunderstorm Wind|28|
|2007-01-01 00:00:00.0000000|Hail||28|
|2007-01-01 00:00:00.0000000||Hail|27|
|2007-01-01 00:00:00.0000000||Thunderstorm Wind|25|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind|Hail|24|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind||24|
|2007-01-01 00:00:00.0000000|Flash Flood|Flash Flood|12|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind|Flash Flood|8|
|2007-01-01 00:00:00.0000000|Flash Flood||8|
|2007-01-01 00:00:00.0000000|漏鬥雲|Thunderstorm Wind|6|
|2007-01-01 00:00:00.0000000||漏鬥雲|6|
|2007-01-01 00:00:00.0000000||Flash Flood|6|
|2007-01-01 00:00:00.0000000|漏鬥雲|漏鬥雲|6|
|2007-01-01 00:00:00.0000000|Hail|Flash Flood|4|
|2007-01-01 00:00:00.0000000|Flash Flood|Thunderstorm Wind|4|
|2007-01-01 00:00:00.0000000|Hail|漏鬥雲|4|
|2007-01-01 00:00:00.0000000|漏鬥雲|Hail|4|
|2007-01-01 00:00:00.0000000|漏鬥雲||4|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind|漏鬥雲|3|
|2007-01-01 00:00:00.0000000|大雨|Thunderstorm Wind|2|
|2007-01-01 00:00:00.0000000|Flash Flood|漏鬥雲|2|
|2007-01-01 00:00:00.0000000|Flash Flood|Hail|2|
|2007-01-01 00:00:00.0000000|強風|Thunderstorm Wind|1|
|2007-01-01 00:00:00.0000000|大雨|Flash Flood|1|
|2007-01-01 00:00:00.0000000|大雨|Hail|1|
|2007-01-01 00:00:00.0000000|Hail|Flood|1|
|2007-01-01 00:00:00.0000000|閃電|Hail|1|
|2007-01-01 00:00:00.0000000|大雨|閃電|1|
|2007-01-01 00:00:00.0000000|漏鬥雲|大雨|1|
|2007-01-01 00:00:00.0000000|Flash Flood|Flood|1|
|2007-01-01 00:00:00.0000000|Flood|Flash Flood|1|
|2007-01-01 00:00:00.0000000||大雨|1|
|2007-01-01 00:00:00.0000000|漏鬥雲|閃電|1|
|2007-01-01 00:00:00.0000000|閃電|Thunderstorm Wind|1|
|2007-01-01 00:00:00.0000000|Flood|Thunderstorm Wind|1|
|2007-01-01 00:00:00.0000000|Hail|閃電|1|
|2007-01-01 00:00:00.0000000||閃電|1|
|2007-01-01 00:00:00.0000000|熱帶風暴|颶風 (颱風)|1|
|2007-01-01 00:00:00.0000000|沿海洪水||1|
|2007-01-01 00:00:00.0000000|裂波電流||1|
|2007-01-01 00:00:00.0000000|大雪||1|
|2007-01-01 00:00:00.0000000|強風||1|

* 表#2:顯示按上一個事件分組的所有不同事件。 例如,第二行顯示之前共發生了 150`Hail`起事件`Tornado`

|StartTime|prev|計數|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||331|
|2007-01-01 00:00:00.0000000|Hail|150|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind|135|
|2007-01-01 00:00:00.0000000|Flash Flood|28|
|2007-01-01 00:00:00.0000000|漏鬥雲|22|
|2007-01-01 00:00:00.0000000|大雨|5|
|2007-01-01 00:00:00.0000000|Flood|2|
|2007-01-01 00:00:00.0000000|閃電|2|
|2007-01-01 00:00:00.0000000|強風|2|
|2007-01-01 00:00:00.0000000|大雪|1|
|2007-01-01 00:00:00.0000000|裂波電流|1|
|2007-01-01 00:00:00.0000000|沿海洪水|1|
|2007-01-01 00:00:00.0000000|熱帶風暴|1|

* 表#3:顯示按下一個事件分組的所有不同事件。 例如,第二行顯示,在之後發生的事件總數為 143`Hail`個`Tornado`

|StartTime|下一步|計數|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||332|
|2007-01-01 00:00:00.0000000|Hail|145|
|2007-01-01 00:00:00.0000000|Thunderstorm Wind|143|
|2007-01-01 00:00:00.0000000|Flash Flood|32|
|2007-01-01 00:00:00.0000000|漏鬥雲|21|
|2007-01-01 00:00:00.0000000|閃電|4|
|2007-01-01 00:00:00.0000000|大雨|2|
|2007-01-01 00:00:00.0000000|Flood|2|
|2007-01-01 00:00:00.0000000|颶風 (颱風)|1|

現在,讓我們嘗試瞭解下一個序列如何繼續:  
`Hail` -> `Tornado` -> `Thunderstorm Wind`

```kusto
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, 
dynamic(['Hail', 'Tornado', 'Thunderstorm Wind']))
```

跳過`Table #1``Table #2``Table #3`和`Hail` -> `Tornado` -> `Thunderstorm Wind`,看 - 我們可以得出結論,在92個事件的順序結束這個序列`Hail`,繼續在 41個`Tornado`事件,並回到 14。

|StartTime|下一步|計數|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||92|
|2007-01-01 00:00:00.0000000|Hail|41|
|2007-01-01 00:00:00.0000000|龍捲風|14|
|2007-01-01 00:00:00.0000000|Flash Flood|11|
|2007-01-01 00:00:00.0000000|閃電|2|
|2007-01-01 00:00:00.0000000|大雨|1|
|2007-01-01 00:00:00.0000000|Flood|1|