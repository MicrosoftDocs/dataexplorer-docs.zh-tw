---
title: 沙箱-Azure 資料總管
description: 本文說明 Azure 資料總管中的沙箱。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 5732d0fa9773d0c8fe5420026cb855d1040b8706
ms.sourcegitcommit: 42cc7d11f41a5bfa9e021764b044dcd68d99a258
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/05/2020
ms.locfileid: "93403760"
---
# <a name="sandboxes"></a>沙箱

Kusto 的資料引擎服務可以針對需要安全隔離的特定流程執行沙箱。
這些流程的範例是使用 [Python 外掛程式](../query/pythonplugin.md) 或 [R 外掛程式](../query/rplugin.md)執行的使用者定義腳本。

為了執行這些沙箱，Kusto 會使用 Microsoft [drawbridge 為何](https://www.microsoft.com/research/project/drawbridge/) project 的演進版本。 其他 Microsoft 服務會使用此解決方案，在多租使用者環境中執行使用者定義物件。

在沙箱中執行的流程不會隔離。 它們也是接近資料) 的本機 (。 這表示遠端呼叫不會新增額外的延遲。

## <a name="prerequisites"></a>必要條件

* 資料引擎不得已啟用 [磁片加密](../../security.md#data-encryption) 。
  * 未來應可支援這兩個並存執行的功能。
* 用來執行沙箱 (映射) 所需的封裝會部署到每個資料引擎的節點，而且需要專用 SSD 空間來執行
  * 估計的大小為 20 gb，大約是 D14_v2 VM 的 SSD 容量2.5%，例如，或 L16_v1 VM 的 SSD 容量0.7%。
  * 這會影響叢集的資料容量，而且可能會影響叢集的 [成本](https://azure.microsoft.com/pricing/details/data-explorer) 。

## <a name="runtime"></a>執行階段

* 沙箱化查詢運算子可能會使用一或多個沙箱來執行它。
  * 沙箱只適用于單一執行，不會在多個回合之間共用，並且會在執行完成後處置。
  * 沙箱會在節點上延遲初始化，而第一次查詢需要沙箱才能執行。
    * 這表示，在節點上使用沙箱的第一次執行外掛程式將包含短暫的準備期間。
  * 當節點重新開機時（例如服務升級的一部分），其上所有執行中的沙箱都會被處置。
* 每個節點都會維護預先定義的沙箱數目，以準備好執行傳入要求。
  * 使用沙箱之後，會自動提供新的沙箱來取代它。
* 如果沒有預先配置的沙箱可用來提供查詢運算子，則會進行節流處理，直到有新的沙箱可用為止。 如需詳細資訊，請參閱 [錯誤](#errors)。 根據 [資料] 節點上的 SKU 和可用資源，新的沙箱配置最多可能需要每個沙箱10-15 秒。

## <a name="limitations"></a>限制

您可以針對每種類型的沙箱，使用叢集層級的 [沙箱原則](../management/sandboxpolicy.md)來控制某些限制。

* **每個節點的沙箱數目：** 每個節點的沙箱數目有限。
  * 當沒有任何可用的沙箱時，所提出的要求將會受到節流。
* **網路：** 沙箱無法 (VM) 或外部的任何資源與虛擬機器上的任何資源進行互動。
  * 沙箱無法與另一個沙箱互動。
* **CPU：** 沙箱可以取用其主機處理器的 CPU 最大速率受限 (預設為 `50%`) 。
  * 當達到限制時，沙箱的 CPU 使用會受到節流處理，但會繼續執行。
* **記憶體：** 沙箱可以取用其主機 RAM 的 RAM 容量上限有限 (預設為 `20GB`) 。
  * 達到限制會導致沙箱終止，並產生查詢執行錯誤。
* **磁片：** 沙箱具有附加的唯一且獨立的目錄。 它無法存取主機的檔案系統。
  * 唯一的資料夾可存取符合沙箱型別的映射/套件。 例如，不可自訂的 Python 或 R 套件。
* **子進程：** 沙箱遭到封鎖而無法產生子進程。

> [!NOTE]
> 搭配沙箱使用的資源，不僅取決於在要求中處理的資料大小，也會根據在沙箱中執行的邏輯，以及它所使用的程式庫的執行。
> 例如，針對 `python` 和 `r` 外掛程式，後者表示使用者提供的腳本，以及它在執行時間所使用的 Python 或 R 程式庫。

## <a name="errors"></a>Errors

|ErrorCode                 |狀態                     |訊息                                                                                            |可能的原因                                                                                                    |
|--------------------------|---------------------------|---------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|E_SB_QUERY_THROTTLED_ERROR|TooManyRequests (429)       |沙箱查詢因為節流而中止。 在部分輪詢可能成功之後重試   |目標節點上沒有可用的沙箱。 新沙箱應該會在幾秒鐘內變成可用         |
|E_SB_QUERY_THROTTLED_ERROR|TooManyRequests (429)       |類型 ' {kind} ' 的沙箱尚未初始化                                            |沙箱原則最近已變更。 新的沙箱遵守新的原則會在幾秒鐘內變成可用|
|                          |InternalServiceError (520)  |沙箱查詢因為初始化沙箱失敗而中止                         |非預期的基礎結構失敗。                         |
