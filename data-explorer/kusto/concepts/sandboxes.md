---
title: 沙箱-Azure 資料總管
description: 本文說明 Azure 資料總管中的沙箱。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 7dbbd4b94169e6b1e23547c7a6b9ed94cf5e70ca
ms.sourcegitcommit: be1bbd62040ef83c08e800215443ffee21cb4219
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/10/2020
ms.locfileid: "84664954"
---
# <a name="sandboxes"></a>沙箱

Kusto 的資料引擎服務可以針對需要安全隔離的特定流程執行沙箱。
這些流程的範例包括使用[Python 外掛程式](../query/pythonplugin.md)或[R 外掛程式](../query/rplugin.md)執行的使用者定義腳本。

若要執行這些沙箱，Kusto 會使用 Microsoft [drawbridge 為何](https://www.microsoft.com/research/project/drawbridge/)project 的進化版。 其他 Microsoft 服務會使用此解決方案，在多租使用者環境中執行使用者定義物件。

在沙箱中執行的流程不會隔離。 它們也是本機（接近資料）。 這表示遠端呼叫不會新增額外的延遲。

## <a name="prerequisites"></a>必要條件

* 資料引擎不得已啟用[磁片加密](../../security.md#data-encryption)。
  * 未來應該會有並存執行的兩項功能支援。
* 執行沙箱所需的封裝（映射）會部署到每個資料引擎的節點，並需要專用的 SSD 空間來執行
  * 估計的大小為 20 gb，大約是 2.5% D14_v2 VM 的 SSD 容量，例如，或 L16_v1 VM 的 0.7% SSD 容量。
  * 這會影響叢集的資料容量，而且可能會影響叢集的[成本](https://azure.microsoft.com/pricing/details/data-explorer)。

## <a name="runtime"></a>執行階段

* 沙箱化查詢運算子可能會使用一或多個沙箱來執行。
  * 沙箱僅適用于單一執行，不會在多個回合之間共用，而且會在執行完成後處置一次。
  * 沙箱會在節點上延遲初始化，第一次查詢需要沙箱執行時。
    * 這表示第一次執行在節點上使用沙箱的外掛程式時，會包含短的準備期間。
  * 當節點重新開機時（例如，做為服務升級的一部分），會處置其上所有執行中的沙箱。
* 每個節點都會維護預先定義的沙箱數，以準備好執行傳入的要求。
  * 使用沙箱之後，會自動提供新的沙箱來取代它。
* 如果沒有預先配置的沙箱可用來提供查詢運算子，它會受到節流處理，直到有新的沙箱可供使用為止。 如需詳細資訊，請參閱[錯誤](#errors)。 根據資料節點上的 SKU 和可用資源而定，每個沙箱的新沙箱配置最多可能需要10-15 秒。

## <a name="limitations"></a>限制

某些限制可以使用叢集層級的[沙箱原則](../management/sandboxpolicy.md)來控制，適用于每種沙箱。

* **每個節點的沙箱數：** 每個節點的沙箱數目有限。
  * 當沒有可用的沙箱時，就會對要求進行節流。
* **網路：** 沙箱無法與虛擬機器（VM）或其外部的任何資源互動。
  * 沙箱無法與另一個沙箱互動。
* **CPU：** 沙箱可以耗用其主機處理器的 CPU 最大速率（預設值為 `50%` ）。
  * 當達到限制時，沙箱的 CPU 使用會進行節流處理，但執行會繼續。
* **記憶體：** 沙箱可以使用其主機 RAM 的 RAM 數量上限（預設值為 `20GB` ）。
  * 達到此限制會導致沙箱終止，並產生查詢執行錯誤。
* **磁片：** 沙箱具有附加的唯一和獨立目錄。 它無法存取主機的檔案系統。
  * 唯一的資料夾提供對符合沙箱類型之影像/套件的存取權。 例如，不可自訂的 Python 或 R 套件。
* **子進程：** 沙箱遭到封鎖而無法產生子進程。

> [!NOTE]
> 搭配沙箱使用的資源，不僅取決於在要求中處理的資料大小，也會根據在沙箱中執行的邏輯，以及其所使用的程式庫執行而定。
> 例如，針對 `python` 和 `r` 外掛程式，後者表示使用者提供的腳本，以及它在執行時間使用的 Python 或 R 程式庫。

## <a name="errors"></a>Errors

|程式碼                      |訊息                                                                                        |可能的原因                                                                                                    |
|--------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|E_SB_QUERY_THROTTLED_ERROR|沙箱化查詢因為節流而中止。 在某些輪詢之後重試可能會成功   |目標節點上沒有可用的沙箱。 新的沙箱應該會在幾秒鐘後變成可用     |
|E_SB_QUERY_THROTTLED_ERROR|種類 ' {kind} ' 的沙箱尚未初始化                       |沙箱原則最近已變更。 新的沙箱遵守新的原則會在幾秒內變成可用           |
